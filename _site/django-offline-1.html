<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Adding Service Workers to your Django App (part 1/3)</title>
  <meta name="description" content="Learn how to add service workers to the polls app from the official django tutorial.">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.ico">

</head>


<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="/about" title="About">About</a>
	    
	  
	    
	  
	    
	      <a href="/autism" title="Autism">Autism</a>
	    
	  
	    
	      <a href="/deutsch" title="Deutsch">Deutsch</a>
	    
	  
	    
	      <a href="/diy" title="DIY">DIY</a>
	    
	  
	    
	  
	    
	  
	    
	      <a href="/programming" title="Code">Code</a>
	    
	  
	    
	      <a href="/travel" title="Travel">Travel</a>
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  

	</div>
  
  <!-- Nav footer -->
	
	  <footer>

	<span>version 1.0.0</span>

</footer>

	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="/">
        <div id="brand">
          aspi<span>girl</span>codes
        </div>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
      
      
	      
	    
	      
	        <a href="/about" title="About">About</a>
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	        <a href="/autism" title="Autism">Autism</a>
	      
	    
	      
	        <a href="/programming" title="Code">Code</a>
	      
	    
	      
	        <a href="/diy" title="DIY">DIY</a>
	      
	    
	      
	        <a href="/travel" title="Travel">Travel</a>
	      
	    
	      
	        <a href="/deutsch" title="Deutsch">Deutsch</a>
	      
	    

      <!-- Nav links -->
	    

    </span>
  </div>
</header>

      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
	<h1>Adding Service Workers to your Django App (part 1/3)</h1>
	<time datetime="2018-03-24T00:00:00+01:00" class="by-line">24 Mar 2018</time>
	<div class="content">

		<p>In this 3 part tutorial you will learn how to add offline functionality to a
Django web-app (the one from the official django tutorial) using a service worker.</p>

<p>I created this tutorial as part of my bachelor thesis, and didn’t change much to it before publishing it here. Hence the somewhat long explanations and formal language in some places.</p>

<ul>
  <li>This is part 1: preparation and setup.</li>
  <li><a href="/django-offline-2">part 2: an offline page using a service worker</a></li>
  <li><a href="/django-offline-3">part 3: implementing a caching strategy</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<h3 id="what-is-a-service-worker">What is a service worker?</h3>
<p>A service worker is a script
written in JavaScript that is run by the browser. However, instead of
running inside your page like your normal client-side code, it runs in
the background. From this position, the service worker can interact both
with the pages it controls, and the server (although it does not have
direct access to any single pages DOM). In particular, a service worker
can intercept requests from a page to the server and do something with
them. It could cache certain responses and return them from the cache
when another request matching those responses comes in, but it can also
send different requests, or read the responses before returning them
back to the page.</p>

<p>The unique possibilities of service workers make them
very powerful. To fully leverage this power, a whole ecosystem of APIs
is being build around service workers, including data storage,
background sync, and push notifications. Those allow websites to evolve
from a simple web page to a full fledged progressive web app that can do
everything a native app can.</p>

<h3 id="what-will-we-do-in-this-tutorial">What will we do in this tutorial?</h3>
<p>Despite the possibilities, the aim of this
tutorial is not to build a progressive web app with lots of bells and
whistles. That would definitely be too much to cover in one go. Things
like background sync, push messages and IndexedDB (a client-side data
storage) will not be covered here.</p>

<p>Instead the tutorial will focus on
the basics of adding a simple service worker to an existing Django
project and discuss things like caching strategies and service worker
life cycle.</p>

<p>On a practical level this tutorial consists of 3 parts. In the first part we go over the Prerequisites and prepare the project for our tutorial.
Then we will create our first service worker and use it to create a simple offline page.
In the third part we will take it further and implement a caching strategy, that will allow us to show the user an older version of the poll data while they are offline.
If you want to go further after that, you will find some useful
resources in the short what’s next section at the end of this tutorial.</p>

<blockquote>
  <p><strong>Note:</strong> Most of this tutorial is inspired by <a href="https://www.youtube.com/watch?v=70L8saIq3uo">Raphael Merx’s talk on
offline Django with Service workers at Pycon Australia 2017</a>
and <a href="http://shop.oreilly.com/product/0636920052067.do">Tal Ater’s book Building Progressive Web Apps</a>.</p>
</blockquote>

<h2 id="prerequisites">Prerequisites</h2>

<p>The starting point of this tutorial is the end of the official Django
tutorial (<a href="https://docs.Djangoproject.com/en/1.11/intro/tutorial01/">https://docs.Djangoproject.com/en/1.11/intro/tutorial01/</a>). A
repository with the codebase to start from is provided. Download
instructions are further down in this section. The Django tutorial is
written for Django 1.11 and Python 3. It consists of 7 parts in which
you learn how to create a simple poll app.</p>

<p>The app is based on two data models. The question model has a publication
date and a question text.
The choice model on the other hand, has a foreign key relationship with
question. This means that one question can relate to multiple choices,
but each choice can only belong to one question. Choices have a choice
text and keep track of the number of times the choice has been chosen.</p>

<p>There are also three main views: one displays a list of questions, the
next displays one question with its choices in a form for voting, and
the last one shows the result of the votes for one question. There are
no custom views for creating and publishing questions. Instead, the
Django admin is used for this.</p>

<p>This tutorial, however, will only add
offline functionality to the custom views, and leave the Django admin
untouched. If you don’t want to do the Django tutorial (again), the
final state of the Django tutorial, and thus the beginning state of this
tutorial is tagged ‘start’ in the following GitHub repository: <a href="https://github.com/aspigirlcodes/django-serviceworker-tutorial.git">https://github.com/aspigirlcodes/django-serviceworker-tutorial.git</a> . This
means you can access it as follows:</p>

<figure class="highlight"><pre><code class="language-shell-session" data-lang="shell-session">$ git clone https://github.com/aspigirlcodes/django-serviceworker-tutorial.git
$ cd django-serviceworker-tutorial/
$ git checkout tags/start -b mytutorial</code></pre></figure>

<blockquote>
  <p><strong>Note:</strong> You still have to create a virtual environment and install
Django 1.11 after cloning the repository.</p>

  <pre><code class="language-shell-session">    $ python3 -m venv service_worker
    $ source service_worker/bin/activate
    $ pip install Django==1.11
</code></pre>

  <p>Then set up your project by doing the initial migrations and creating
a superuser</p>

  <pre><code class="language-shell-session">    $ python manage.py migrate
    $ django-admin createsuperuser
</code></pre>
</blockquote>

<p>If you have finished the Django tutorial, you will have enough knowledge
of Python and Django to follow along with this tutorial. As service
workers are implemented in JavaScript, some experience with JavaScript
is useful as well. However, you do not need to be a JavaScript expert.
If you have followed a beginner’s tutorial about JavaScript or added
some JavaScript to a web page by Google, trial and error, you should be
good to go. One thing you might want to have a look at if you are not
familiar with them already are JavaScript promises, as they are used a
lot in service workers.</p>

<p>You will also need a browser with developer
tools for service workers. The browsers Firefox and Chrome both have
this.</p>

<h2 id="preparation-improve-django-templates-to-output-a-propper-html-page">Preparation: Improve Django Templates to Output a Propper HTML Page</h2>

<p>The Django tutorial sticks to the bare minimum when it comes to the
templates HTML content. Html, head and body tags are not included. This
is perfectly acceptable for a back end framework introduction tutorial,
but now that you will start working on the front end more, it is a good
time to fix this first.</p>

<p>First, create a new file named <code class="highlighter-rouge">base.html</code> in <code class="highlighter-rouge">polls/templates/polls</code> , and put the
following content in it:</p>

<figure class="highlight"><pre><code class="language-htmldjango" data-lang="htmldjango">{% load static %}
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1,
      shrink-to-fit=no"&gt;
    &lt;title&gt;{% block title %}{% endblock title %}&lt;/title&gt;

    &lt;link rel="stylesheet" type="text/css"
      href="{% static "polls/style.css" %}" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    {% block content %}
    {% endblock content %}
    {% block scripts %}
    {% endblock scripts %}
  &lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>Then, change the three existing templates. Note that you can delete the
stylesheet link in <code class="highlighter-rouge">index.html</code>, as it is included in the above <code class="highlighter-rouge">base.html</code> template.</p>

<figure class="highlight"><pre><code class="language-htmldjango" data-lang="htmldjango">{% extends "polls/base.html" %}

{% block title %} Polls List {% endblock title %}
{% block content %}
  {% if latest_question_list %}
    ...
  {% endif %}
{% endblock content %}</code></pre></figure>

<figure class="highlight"><pre><code class="language-htmldjango" data-lang="htmldjango">{% extends "polls/base.html" %}

{% block title %} Answer poll {% endblock title %}

{% block content %}
  &lt;h1&gt;...
  ...
  &lt;/form&gt;
{% endblock content %}</code></pre></figure>

<figure class="highlight"><pre><code class="language-htmldjango" data-lang="htmldjango">{% extends "polls/base.html" %}

{% block title %} Poll results {% endblock title %}

{% block content %}
  &lt;h1&gt;...
  ...
  ....&lt;/a&gt;
{% endblock content %}</code></pre></figure>

<p>Although this is not absolutely necessary, you can also add the
following extra rule to <code class="highlighter-rouge">style.css</code> so that the html and body elements fill the
whole page. By this, the image, set to be in the lower right corner of
the body element, will be at the bottom of the page, no matter how much
content the page has.</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">html</span><span class="o">,</span> <span class="nt">body</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span><span class="m">100%</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">...</span></code></pre></figure>

<p>That was it for the preparation step! You are now ready to begin working on
our first service worker script.</p>

<ul>
  <li>This was part 1: preparation and setup.</li>
  <li><a href="/django-offline-2">part 2: an offline page using a service worker</a></li>
  <li><a href="/django-offline-3">part 3: implementing a caching strategy</a></li>
</ul>


	</div>
	<p>
		Categories: 
		
  		<a href="/programming">Programming</a>
  		
  	
	</p>
</article>


	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer>
  <span><a href="https://www.twitter.com/aspigirlcodes">@aspigirlcodes</a></span>
  <br/>
  <span>Built with Jekyll and the Monochrome theme</span>
</footer>


	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
